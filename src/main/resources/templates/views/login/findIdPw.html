<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/default_layout}">
<body>
<div layout:fragment="content">

    <div class="subpage_banner" style="background-image: url(/assets/images/top_visual.png)">
        <div class="ly_grid">
            <div class="banner_title_area">
                <h3 class="banner_title">로그인</h3>
            </div>
        </div>
    </div>

    <!-- CONTAINER -->
    <div class="container">
        <!-- CONTENT -->
        <div class="content">
            <div class="ly_grid">
                <!-- 컴포넌트 : 탭 -->
                <div class="bl_tab2 js_tab">
                    <ul class="bl_tab2_menu js_tab_menu">
                        <li id="id_find">
                            <a href="#none" onclick="reset('id')">아이디 찾기</a>
                        </li>
                        <li id="pw_find">
                            <a href="#none" onclick="reset('pw')">비밀번호 찾기</a>
                        </li>
                    </ul>

                    <div class="bl_tab2_body js_tab_contents hp_mt60">
                        <!-- 아이디 찾기 -->
                        <div class="bl_tab2_item js_tab_item">
                            <div class="cont_description">
                                <div>아이디를 찾기 위한 연령 정보를 선택해주세요.</div>
                                <div class="radio_box">
                                    <input id="non_youth_id" type="radio" value="0" name="youthChk" checked>
                                    <label for="non_youth_id">
                                        <span></span>
                                        14세 이상
                                    </label>
                                </div>
                                <div class="radio_box">
                                    <input id="youth_id" type="radio" value="1" name="youthChk">
                                    <label for="youth_id">
                                        <span></span>
                                        14세 미만
                                    </label>
                                </div>
                            </div>
                            <div class="card_wrap" style="justify-content: center">
                                <div class="card half non_youth">
                                    <div>
                                        <img th:src="@{/assets/images/subpage_join/join_icon3.png}" alt="" >
                                        <div class="text_box">
                                            <p class="card_title">휴대폰 인증</p>
                                            <p class="card_text">실명인증을 통해 회원님의 정보를 확인하고자 하시면<br >아래 ‘<span class="color_blue">인증하기</span>’버튼을 클릭해 주세요.</p>
                                        </div>
                                        <button type="button" class="btn_type1 btn_blue" onclick="findId('non_youth')">인증하기</button>
                                        <!-- 1. 휴대폰 본인 인증 버튼 -->
                                    </div>
                                </div>
                                <div class="card half youth">
                                    <div>
                                        <img th:src="@{/assets/images/subpage_join/join_icon3.png}" alt="" >
                                        <div class="text_box">
                                            <p class="card_title">휴대폰 인증</p>
                                            <p class="card_text">보호자의 실명인증을 통해 피보호자의 정보를 확인하고자 하시면<br >아래 ‘<span class="color_blue">인증하기</span>’버튼을 클릭해 주세요.</p>
                                        </div>
                                        <button type="button" class="btn_type1 btn_blue" onclick="findId('youth')">인증하기</button>
                                        <!-- 1. 휴대폰 본인 인증 버튼 -->
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 비밀번호 찾기 -->
                        <div class="bl_tab2_item js_tab_item">
                            <div class="cont_description">
                                <div>비밀번호를 찾기 위한 연령 정보를 선택해주세요.</div>
                                <div class="radio_box">
                                    <input id="non_youth_pw" type="radio" value="0" name="youthChk" checked>
                                    <label for="non_youth_pw">
                                        <span></span>
                                        14세 이상
                                    </label>
                                </div>
                                <div class="radio_box">
                                    <input id="youth_pw" type="radio" value="1" name="youthChk">
                                    <label for="youth_pw">
                                        <span></span>
                                        14세 미만
                                    </label>
                                </div>
                                <div class="mt-3 mb-5">
                                    <label for="pwCheckId">아이디<span class="essential">*</span></label>
                                    <input type="text" name="pwCheckId" id="pwCheckId" class="common_input2 ms-2" placeholder="아이디를 입력해주세요.">
                                </div>
                            </div>
                            <div class="card_wrap justify-content-center">
                                <div class="card half non_youth">
                                    <div>
                                        <img th:src="@{/assets/images/subpage_join/join_icon3.png}" alt="" >
                                        <div class="text_box">
                                            <p class="card_title">휴대폰 인증</p>
                                            <p class="card_text">실명인증을 통해 회원님의 정보를 확인하고자 하시면<br >아래 ‘<span class="color_blue">인증하기</span>’버튼을 클릭해 주세요.</p>
                                        </div>
                                        <button type="button" class="btn_type1 btn_blue" onclick="findPw('non_youth')">인증하기</button>
                                        <!-- 1. 휴대폰 본인 인증 버튼 -->
                                    </div>
                                </div>
                                <div class="card half youth">
                                    <div>
                                        <img th:src="@{/assets/images/subpage_join/join_icon3.png}" alt="" >
                                        <div class="text_box">
                                            <p class="card_title">휴대폰 인증</p>
                                            <p class="card_text">보호자의 실명인증을 통해 피보호자의 정보를 확인하고자 하시면<br >아래 ‘<span class="color_blue">인증하기</span>’버튼을 클릭해 주세요.</p>
                                        </div>
                                        <button type="button" class="btn_type1 btn_blue" onclick="findPw('youth')">인증하기</button>
                                        <!-- 1. 휴대폰 본인 인증 버튼 -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <th:block layout:fragment="script">
        <script th:inline="javascript">
            /* <![CDATA[ */
            function onLoadSubmit(){
                console.log('error: ', [[ ${errorMessage} ]] )
                console.log('result: ', [[ ${result} ]] )
                console.log('param: ', [[ ${param} ]] )

                reset('id')
                let searchParams = new URLSearchParams(window.location.search);
                let pw = searchParams.get("pw");
                if(pw=="true"){
                    $("#pw_find").trigger("click")
                    reset('pw')
                }

                $("input[name='youthChk']").change(function(){
                    var val = $("input[name='youthChk']:checked").val();
                    if (val==="1") {
                        $('.non_youth').hide()
                        $('.youth').show()
                    } else {
                        $('.non_youth').show()
                        $('.youth').hide()
                    }
                });
            }
            /* ]]> */

            function reset(pw) {
                if (pw=="pw") {
                    $("#non_youth_pw").prop("checked", true)
                } else {
                    $("#non_youth_id").prop("checked", true)
                }
                $('.non_youth').show()
                $('.youth').hide()
            }

            function findId(youth) {
                const wWidth = 480;
                const wHeight = 800;
                const wX = (window.screen.width - wWidth) / 2;
                const wY = (window.screen.height - wHeight) / 2;
                if (youth=='youth') {
                    authPop = window.open("/user/find/authentication?youth="+youth, "mbAuthPopup", "directories=no,toolbar=no,left="+wX+",top="+wY+",width="+wWidth+",height="+wHeight);
                } else {
                    authPop = window.open("/user/find/authentication", "mbAuthPopup", "directories=no,toolbar=no,left="+wX+",top="+wY+",width="+wWidth+",height="+wHeight);
                }
                window.call = function (obj) {
                    let userId='';
                    let userIds='';
                    let userNames='';
                    const form = document.createElement('form'); // 폼객체 생성

                    if (youth=='youth') {
                        userIds=obj.userIds;
                        userNames=obj.userNames;

                        const youthInput = document.createElement('input'); // 형식
                        youthInput.setAttribute('type', 'text'); // type
                        youthInput.setAttribute('name', 'youth'); // 객체이름
                        youthInput.setAttribute('value', youth); //객체값
                        form.appendChild(youthInput);
                        const userIdInput = document.createElement('input'); // 형식
                        userIdInput.setAttribute('type', 'text'); // type
                        userIdInput.setAttribute('name', 'userIds'); // 객체이름
                        userIdInput.setAttribute('value', userIds); //객체값
                        form.appendChild(userIdInput);
                        const userNameInput = document.createElement('input'); // 형식
                        userNameInput.setAttribute('type', 'text'); // type
                        userNameInput.setAttribute('name', 'userNames'); // 객체이름
                        userNameInput.setAttribute('value', userNames); //객체값
                        form.appendChild(userNameInput);
                    } else {
                        userId=obj.userId;
                        const userIdInput = document.createElement('input'); // 형식
                        userIdInput.setAttribute('type', 'text'); // type
                        userIdInput.setAttribute('name', 'userId'); // 객체이름
                        userIdInput.setAttribute('value', userId); //객체값
                        form.appendChild(userIdInput);
                    }

                    document.body.appendChild(form);
                    form.setAttribute('method', 'post'); //get,post 가능
                    form.setAttribute('action', "/login/find/result/id"); //보내는 url
                    form.submit();
                }
            }

            var authPop;
            // 비밀번호 찾기
            function findPw(youth) {
                if ($('#pwCheckId').val()) {
                    const wWidth = 480;
                    const wHeight = 800;
                    const wX = (window.screen.width - wWidth) / 2;
                    const wY = (window.screen.height - wHeight) / 2;
                    if (youth=='youth') {
                        authPop = window.open("/user/find/authentication?youth="+youth, "mbAuthPopup", "directories=no,toolbar=no,left="+wX+",top="+wY+",width="+wWidth+",height="+wHeight);
                    } else {
                        authPop = window.open("/user/find/authentication", "mbAuthPopup", "directories=no,toolbar=no,left="+wX+",top="+wY+",width="+wWidth+",height="+wHeight);
                    }
                    window.call = function (obj) {
                        let userId='';
                        const form = document.createElement('form'); // 폼객체 생성

                        if (youth=='youth') {
                            let ids = obj.userIds.split(",");
                            let num = -1;
                            ids.forEach((value, index) => {
                                if (value == $('#pwCheckId').val()) {
                                    num = index;
                                }
                            })

                            if (num >= 0) {
                                userId=ids[num];
                                const youthInput = document.createElement('input'); // 형식
                                youthInput.setAttribute('type', 'text'); // type
                                youthInput.setAttribute('name', 'youth'); // 객체이름
                                youthInput.setAttribute('value', youth); //객체값
                                form.appendChild(youthInput);
                                const userIdInput = document.createElement('input'); // 형식
                                userIdInput.setAttribute('type', 'text'); // type
                                userIdInput.setAttribute('name', 'userId'); // 객체이름
                                userIdInput.setAttribute('value', userId); //객체값
                                form.appendChild(userIdInput);
                                document.body.appendChild(form);
                                form.setAttribute('method', 'post'); //get,post 가능
                                form.setAttribute('action', "/login/find/result/pw"); //보내는 url
                                form.submit();
                            } else {
                                authPop.close();
                                alert("본인인증 아이디와 입력한 아이디가 일치하지 않습니다.");
                            }
                        } else {
                            if ($('#pwCheckId').val() == obj.userId) {
                                let userId=obj.userId;
                                const form = document.createElement('form'); // 폼객체 생성
                                const userIdInput = document.createElement('input'); // 형식
                                userIdInput.setAttribute('type', 'text'); // type
                                userIdInput.setAttribute('name', 'userId'); // 객체이름
                                userIdInput.setAttribute('value', userId); //객체값
                                form.appendChild(userIdInput);
                                document.body.appendChild(form);
                                form.setAttribute('method', 'post'); //get,post 가능
                                form.setAttribute('action', "/login/find/result/pw"); //보내는 url
                                form.submit();
                            } else {
                                authPop.close();
                                alert("본인인증 아이디와 입력한 아이디가 일치하지 않습니다.");
                            }
                        }
                    }
                } else {
                    alert("비밀번호 찾기를 진행할 아이디를 입력해주세요.")
                }
            }
        </script>
    </th:block>

</div>
</body>
</html>
